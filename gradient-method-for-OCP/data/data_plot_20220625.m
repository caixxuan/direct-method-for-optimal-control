%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 说明：对比《最优化与最优控制》 pp.257 例13.1 用梯度法和共轭梯度法的结果
% 作者：李凌炜
% 时间：2022/06/25
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
clear;clc;close all;

%% 模式选择
% mode = 'case 1';
% mode = 'case 2';
mode = 'case 3';

%% Case 1 的画图部分
if strcmp(mode,'case 1')
% 导入梯度法的数据
res_gm = load('gradient_method_OCP_case1.mat');
% 导入共轭梯度法的数据
res_cgm = load('conjugate_gradient_method_OCP_case1.mat');

% 画图
window_width = res_gm.window_width;
window_height = res_gm.window_height;

% 状态变量的图像
k = 0;
% x1(t)的图像
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
plot(res_gm.Tx,  res_gm.X,  '-',  'LineWidth',1.5);hold on;
plot(res_cgm.Tx, res_cgm.X, '--', 'LineWidth',1.5);
xlabel('Time');
ylabel('$x(t)$','interpreter','latex');
set(gca,'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5);
legend('梯度法','共轭梯度法',...
        'Location','Northeast',...
        'FontSize',10,...
        'FontName','华文中宋');

% 控制量的图像
k = 1;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
plot(res_gm.Tu,  res_gm.u,  '-',  'LineWidth',1.5);hold on;
plot(res_cgm.Tu, res_cgm.u, '--', 'LineWidth',1.5);
xlabel('Time');
ylabel('$u(t)$','Interpreter','Latex');
set(gca,'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5);
legend('梯度法','共轭梯度法',...
        'Location','Northwest',...
        'FontSize',10,...
        'FontName','华文中宋');
   
% 性能指标的图像
k = 2;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
plot(res_gm.t_plot, res_gm.J_plot, 'x-','LineWidth',1.5);hold on;
plot(res_cgm.t_plot,res_cgm.J_plot,'x-','LineWidth',1.5);
xlabel('Time');
ylabel('$J$','Interpreter','Latex');
set(gca,'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5);
legend('梯度法','共轭梯度法',...
        'Location','Northeast',...
        'FontSize',10,...
        'FontName','华文中宋');
end

%% Case 2 的画图部分
if strcmp(mode,'case 2')
% 导入梯度法的数据
res_gm001 = load('gradient_method_OCP_case2_step_0.01.mat');
res_gm01  = load('gradient_method_OCP_case2_step_0.1.mat');
res_gm055 = load('gradient_method_OCP_case2_step_0.55.mat');
% 导入共轭梯度法的数据
res_cgm001 = load('conjugate_gradient_method_OCP_case2_step_0.01.mat');
res_cgm01  = load('conjugate_gradient_method_OCP_case2_step_0.1.mat');
res_cgm055 = load('conjugate_gradient_method_OCP_case2_step_0.55.mat');

% 画图
window_width = res_gm001.window_width;
window_height = res_gm001.window_height;
 
% 性能指标的图像
k = 0;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
plot(res_gm001.t_plot, res_gm001.J_plot, 'o-','LineWidth',1.5);hold on;
plot(res_gm01.t_plot,  res_gm01.J_plot,  'o-','LineWidth',1.5);
plot(res_gm055.t_plot, res_gm055.J_plot, 'o-','LineWidth',1.5);
plot(res_cgm001.t_plot,res_cgm001.J_plot,'x-','LineWidth',1.5);
plot(res_cgm01.t_plot, res_cgm01.J_plot, 'x-','LineWidth',1.5);
plot(res_cgm055.t_plot,res_cgm055.J_plot,'x-','LineWidth',1.5);

xlabel('Time');
ylabel('$J$','interpreter','latex');
set(gca,'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5,...
        'XTick',0:5:50);
legend('$gm-0.01$','$gm-0.1$','$gm-0.55$',...
        '$cgm-0.01$','$cgm-0.1$','$cgm-0.55$',...
        'Location','northeast',...
        'FontSize',10,...
        'FontName','Times New Roman',...
       'Interpreter','Latex');

% 柱状图
k=1;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
y = [length(res_gm001.J_plot) length(res_cgm001.J_plot)
     length(res_gm01.J_plot)  length(res_cgm01.J_plot)
     length(res_gm055.J_plot) length(res_cgm055.J_plot)];
b = bar(y);
ch = get(b,'children');
ylabel('Iteration times');
set(gca,'YLim',[0,55],...
        'YTick',0:10:55,...
        'XTickLabel',{'Step size: 0.01','Step size: 0.1','Step size: 0.55'},...
        'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5);
legend('梯度法','共轭梯度法',...
        'Location','northeast',...
        'FontSize',10,...
        'FontName','华文中宋');
    
text(0.78,51.5,...
     strcat(num2str(length(res_gm001.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
 
text(1.10,3.5,...
     strcat(num2str(length(res_cgm001.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
 
text(1.78,38.5,...
     strcat(num2str(length(res_gm01.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
 
text(2.10,4.5,...
     strcat(num2str(length(res_cgm01.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
 
text(2.82,7.5,...
     strcat(num2str(length(res_gm055.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
 
text(3.10,7.5,...
     strcat(num2str(length(res_cgm055.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
end

%% Case 3 的画图部分
if strcmp(mode,'case 3')
% 导入梯度法的数据
res_gm_without = load('gradient_method_OCP_case3_without_armijo.mat');
res_gm_with    = load('gradient_method_OCP_case3_with_armijo.mat');
% 导入共轭梯度法的数据
res_cgm_without = load('conjugate_gradient_method_OCP_case3_without_armijo.mat');
res_cgm_with    = load('conjugate_gradient_method_OCP_case3_with_armijo.mat');

% 画图
window_width = res_gm_with.window_width;
window_height = res_gm_with.window_height;

% 性能指标的图像
k = 0;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
plot(res_gm_without.t_plot, res_gm_without.J_plot, 'o-','LineWidth',1.5);hold on;
plot(res_gm_with.t_plot,    res_gm_with.J_plot,    'o-','LineWidth',1.5);
plot(res_cgm_without.t_plot,res_cgm_without.J_plot,'x-','LineWidth',1.5);
plot(res_cgm_with.t_plot,   res_cgm_with.J_plot,   'x-','LineWidth',1.5);

xlabel('Time');
ylabel('$J$','interpreter','latex');
set(gca,'FontSize',15,...
        'FontName','Times New Roman',...
        'LineWidth',1.5,...
        'XTick',0:1:5);
legend('$gm-armijo$','$gm-no-armijo$',...
       '$cgm-armijo$','$cgm-no-armijo$',...
       'Location','northeast',...
       'FontSize',10,...
       'FontName','Times New Roman',...
       'Interpreter','Latex');
   
% 柱状图
k=1;
figure('color',[1 1 1],'position',[50+k*window_width,200,window_width,window_height]);
y = [length(res_gm_with.J_plot) length(res_gm_without.J_plot)
     length(res_cgm_with.J_plot)  length(res_cgm_without.J_plot)];
b = bar(y);
ch = get(b,'children');
ylabel('Iteration times');
set(gca,'YLim',[0,8],...
        'YTick',0:8,...
        'XTickLabel',{'梯度法','共轭梯度法'},...
        'FontSize',15,...
        'FontName','华文中宋',...
        'LineWidth',1.5);
legend('$armijo$','$no \ armijo$',...
        'Location','northeast',...
        'FontSize',10,...
        'FontName','Times New Roan',...
        'Interpreter','Latex');
    
text(0.83,6.3,...
     strcat(num2str(length(res_gm_with.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
text(1.11,6.3,...
     strcat(num2str(length(res_gm_without.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
text(1.83,4.3,...
     strcat(num2str(length(res_cgm_with.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
text(2.11,5.3,...
     strcat(num2str(length(res_cgm_without.J_plot))),...
     'FontName','Times New Roman',...
     'FontSize',15);
end